## 电商后台管理系统 

**所用技术**

* Vue + ElementUI 框架 + Mysql  
* api 接口地址 axios.defaults.baseURL = 'https://lianghj.top:8888/api/private/v1/'

### 登录组件

1. 利用element 框架 快速搭建一个 登录框    有用户名和密码 输入框    < el-form  >

   1. 采用elementui表达 自带的 rules 规则 判断输入内容 规则 是否为空  或者符合长度

   2.  ```  
       :rules="loginFormRules"
        loginFormRules: {
              username: [
                { required: true, message: '用户名不能为空', trigger: 'blur' },
                { min: 3, max: 10, message: '长度在 3 到 10 个字符', trigger: 'blur' }
              ],
               password: [
                { required: true, message: '密码不能为空', trigger: 'blur' },
                { min: 6, max: 20, message: '密码不得少于6位', trigger: 'blur' }
              ]
       ```

2. 消息提示

   1. 利用element ui 的message 组件    

      ```
       this.$message.error('登录失败！'); 
       this.$message.success('登录成功');	
       
      ```

   

3. 登录预验证 判断用户名密码正确 

   ``` 
     login () {
         this.$refs.loginFormRef.validate(async (valid) => {
           if (!valid) return
           const { data: res } = await this.$http.post('login', this.loginForm)
           if (res.meta.status !== 200) return this.$message.error('登录失败！');
           this.$message.success('登录成功');
           window.sessionStorage.setItem('token',res.data.token); // 后将token 保存到客户端的 sessionStorage 中
           this.$router.push('/home');
           
         })
       },
   ```

   

4. 登录成功之后将token 保存到客户端的 sessionStorage 中

   1. 项目中除了登录之外的其他API 接口，必须在登录之后才能访问

   2. token 只应在当前网站打开期间生效，所以将token 保存在sessionStorage 中       

      ``` 
       window.sessionStorage.setItem('token',res.data.token);
      ```

5. 通过编程时导航跳转到后台主页 ，路由地址是 /home 

6. 路由导航守卫 控制访问权限

   1. 如果用户没有登录，但是直接通过URL  访问特定页面，需要重新导航到 登录页面  

      ``` 
      router.beforeEach((to,from,next)=>{
        // to 将要访问的路径
        // from  代表从哪个路径跳转而来
        // next 是一个函数，表示放行 
        if(to.path === '/login')  return next() // 访问登录页 直接放行 
        // 获取token
        const tokenStr= window.sessionStorage.getItem('token')
        if( !tokenStr ) return next('/login') // 没有token 强制跳转到登录页 
        next()
      })
      ```

7. 退出登录  

   1. 清空 sessionStorage 中的token     

   2. 路由跳转到 /login  

      ``` 
       window.sessionStorage.clear();
       this.$router.push('/login');
      ```

      

### Home组件    

#### 左侧列表

1. 使用elemenui中的 el-menu 组件 来构建导航菜单 

2. 需要授权的 API ，必须在请求头中使用 `Authorization` 字段提供 `token` 令牌，所以要设置axios 请求拦截 ，添加 token值  

   ``` vue
   axios.interceptors.request.use(config=>{         	config.headers.Authorization=window.sessionStorage.getItem('to  ken')
         return config
   })
   
   ```

3.  创建created 生命周期 ，在页面渲染之前获取到数据

   ``` 
   created(){
           this.getMenuList()
       },
   async getMenuList(){
               const{data:res} = await  this.$http.get('menus')
               if(res.meta.status !== 200) return 	vvvv    		this.$message.error(res.meta.msg)
               this.menulist=res.data
               console.log(res);
   }
   ```

4.  在列表模板中  v-for  遍历数据 

   ``` 
   v-for="item in menulist" :key="item.id"
   <span> {{item.authName}} </span>
   ```

5. 左侧列表数据 进行美化 ，更换标题之前的 图标

6. 路由重定向，进入 home 页面后，给Main 区域添加个组件，设置到home路由的 children 中 

   ``` js
    { 
       path:'/home' , 
       component: Home ,
       redirect:'/welcome' ,
       children:[
         {
           path:'/welcome',
           component:Welcome
         }
       ]
      
     }
   ```

7. 将路由菜单改造为 路由链接  。

   * 给menu 组件 **添加 router 属性**   使用 vue-router 的模式，

   * 启用该模式会在激活导航时以 index 作为 path 进行路由跳转

   * ``` js
       <el-menu-item :index="'/'+items.path" v-for="items in item.children" :key="items.id">
     ```


#### 右侧用户列表

1. 获取用户列表  

   ``` js
   //  data中填写相关属性 
     	data() {
         return {
           // 获取用户列表的参数对象 
           queryInfo:{
             query:'',
             pagenum:1,
             pagesize:2
           },
           userlist:[],
           total:0
         }
       },
       
    // script
     created(){
         this.getUserList()
       },
       methods:{   // async 优化promise 
      async   getUserList(){
          const {data:res} =  await this.$http.get('users',{params:this.queryInfo})
           if(res.meta.status !== 200) return this.$message.error(res.meta.msg)
           console.log(res);
           this.userlist =res.data.users
           this.total=res.data.total
         }
       }
   
   ```

2. 利用 Element  table 组件  搭建 用户列表表格 

   ``` js
   // props为 数据对应的键    stripe 为 斑马纹效果 
   <el-table :data="userlist" style="width: 100%" border="1" stripe class="userCard">
               <el-table-column prop="username" label="姓名" width="180"></el-table-			   column>
   </el-table>
   // 添加索引列  1  2 3  4  index 
    <el-table-column type="index"  label="#"></el-table-column>
   							
   ```

3. 渲染用户状态 开关 

   ``` 
   作用域插槽  在父组件中使用子组件的数据了。
    <template slot-scope="scope"> <!-- 作用域插槽 -->
                      
        <el-switch
         v-model="scope.row.mg_state">
                        
       </el-switch>
   </template>
   ```

4. 分页导航条 

   ``` 
   利用element ui的  el-pagination 实现  
    <el-pagination
                   @size-change="handleSizeChange"
                   @current-change="handleCurrentChange"
                   :current-page="queryInfo.pagenum"
                   :page-sizes="[1,2,3,5,10]"
                   :page-size="queryInfo.pagesize"
                   layout="total, sizes, prev, pager, next, jumper"
                   :total="total">
     </el-pagination>
     
       // 分页 pagesize 改变的事件    拿到新数据重新携带新数据 调用用户列表api 
         handleSizeChange(newSize){
             this.queryInfo.pagesize = newSize
             this.getUserList();
         },
         handleCurrentChange(newPage){
             this.queryInfo.pagenum=newPage
             this.getUserList();
         }
   ```

   







