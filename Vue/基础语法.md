# Vuex

>Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。可以很方便的实现组件之间的数据的共享。

注意：

只有组件之间共享的数据，才有必要存储到vuex中，组件中的私有数据，依旧存储到自身的data中即可。

Vuex基本结构：

```js
import Vue from "vue";
import Vuex from "vuex";

Vue.use(Vuex);

export default new Vuex.Store({
  state: {
  },
  mutations: {
    
  },
  actions: {},
  modules: {},
});
```

## state

> 存放公共数据。所有共享数据都要统一放到Store中的State中 

```js
 state: {
    count: 2
 },
```

组件访问State中数据的第一种方式：

```js
// 在 template区域中this可以省略 

this.$store.state.全局数据名称
```

第二种方式：

```js
1. 从Vuex中按需导入 mapState函数
import {mapState} from 'vuex'
2. 通过导入 mapSate 函数，将当前组件所需的公共数据 映射到 当前组件的计算属性 computed中
computed: {
    ...mapState(['count']),
},
```

而**修改state中的数据**就要用到 `Mutations`

## Mutations

>用来修改 State中的数据 。  但不支持异步修改

优点：

1. 可以集中监控所有数据的变化
2. 减少 直接操作 Store的数据

使用：

```js
mutations: {  // 选择性 添加参数 
    inc(state, step) {
      state.count += step;
    },
    dec(state, step) {
      state.count -= step;
    }
  },
```

触发mutation的第一种方式 ：

```js
// 在组件 methods 中通过 commit 来触发 mutation
methods: {
    add() {
      this.$store.commit('inc', 2)
    },
    dec() {
      this.$store.commit('dec', 2)
    },
},
```

第二种方式 ：

```js
// 组件中导入 
import { mapMutations } from 'vuex'
// 将导入的函数 映射到 methods中
methods:{
   ...mapMutations(['sub']),
}
// 在template中 click的事件函数中使用 sub方法 , 参数可传可不传
  methods: {
    ...mapMutations(['sub']),
    handlesub() {
      this.sub(3)
    },
  },
}

```

## Actions

> 用来处理异步任务 。 通过触发Mutation的方式间接变更数据 。不能直接修改state中的数据

异步执行的第一种方法：

```js
// 要异步执行的 mutation
 mutations: {  // 只准许写 同步代码  
    sub(state, step) {
      state.count += step;
    }
  },
// 定义actions函数，写事件 
// 通过 context.commit 进行触发 mutation中的函数 
 actions: {
    asyncsub(context, step) {
      setTimeout(() => {
        context.commit('sub', step)
      }, 2000)
    }
 },
 // 组件中绑定 asysub 发送 ，由dispatch触发actions中的异步函数  
   asysub() {
     this.$store.dispatch('asyncsub', 10)
   },
```

第二种方法：（和mapMutation ， mapState雷同）

```js 
// 1. 导入 mapActions 函数
import {  mapActions } from 'vuex'
// 2.methods中映射 mapActions
...mapActions(['asyncsub']),
// 3. 组件绑定点击事件，调用actions函数 
 mapsub() {
  this.asyncsub(10)
},
```

## Getter

> Getter用于对Store中的数据进行加工处理形成新的数据。类似于计算属性

**注意：**

Store中的数据发生变化，Getter的数据也会跟着变化。

**使用：**

```js
// 1.vuex中定义 getters函数
 getters: {
    newNum: state => {
      return `当前最新的数据是${state.count}`
    }
  },
    
// 2.组件中使用它！！ 
   this.$store.getters.newNum

// 使用它的第二种方式是导入并映射
import {  mapGetters } from 'vuex'
// 在computed中进行映射 getters函数
 computed: {
    ...mapState(['count']),
    ...mapGetters(['newNum']),
  },
```



